'use client'

import { useQuery } from '@tanstack/react-query'
import { Token } from 'sushi/currency'
import type { Address } from 'viem'
import type { Approvals } from '~evm/claims/rp2/check-approvals/route'

interface UseRP2ExploitCheck {
  account: Address | undefined
}

export const useRP2ExploitCheck = ({ account }: UseRP2ExploitCheck) => {
  return useQuery({
    queryKey: ['useRP2ExploitCheck', { account }],
    enabled: Boolean(account),
    queryFn: async () => {
      if (!account) return []

      const data: Approvals = await fetch(
        `/claims/rp2/check-approvals?account=${account}`,
      ).then((res) => res.json())

      return data.map((token) => new Token(token))
    },
    refetchOnWindowFocus: false,
    refetchOnReconnect: false,
    refetchIntervalInBackground: false,
    refetchOnMount: false,
    refetchInterval: 10000 * 60 * 60,
  })
}
